<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">

<link rel="icon" href="../../favicon.ico">
<script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
<link href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

<title>Seattle Parks Complete</title>

<link href="parks_style.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>

<!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
<div class="container">
  <div class="navbar-header">
    <span class="icon-bar"></span>
  Seattle Parks Complete
  </div>
<ul class="nav navbar-nav navbar-right">
<li><a href="#" data-toggle="modal" data-target="#progressModal">Your Progress</a></li>
<li><a href="#" data-toggle="modal" data-target="#aboutModal">About</a></li>
</ul>

</div>
</nav>

<div class="container">
<!-- Modal -->
<div id="aboutModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
      <h4 class="modal-title">About this site</h4>
      </div>
      <div class="modal-body">
        <p>This is a map of all parks recognized by the City of Seattle</p>
        <p>If you have been to a particular park, just click on it and the map will automagically remember your visit.</p>
        <p>Official city listing of parks <a href="http://www.seattle.gov/parks/listall.asp">here</a>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
      </div>
    </div>
  </div>
</div>

<div id="progressModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
      <h4 class="modal-title">Your Progress thus far</h4>
      </div>
      <div class="modal-body">
        <p> You have been to parks <h1 id="myModalLabel"></h1>recognized by the City of Seattle</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
      </div>
    </div>
  </div>
</div>

<div id="map"></div>
<script src="seattle-parks.geojson"></script>
<script>

var visitedCount = 0;
for(var i=0; i < geojson.features.length; i++){
    parkName = geojson.features[i]['properties']['name']
    if(parkName in localStorage){
      geojson.features[i]['properties']['visit'] = '#89959C'
      visitedCount++;
    }
  }
document.getElementById("myModalLabel").innerHTML = visitedCount;

var map = L.map('map').setView([47.6031447,-122.3285673], 12);

L.tileLayer('https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
  id: 'stedy.mck2dne6',
  accessToken: 'pk.eyJ1Ijoic3RlZHkiLCJhIjoiUU9kOC1xcyJ9.xmKXVS0kLIjF5hR6rBzTCw'
  }).addTo(map);

function onEachFeature(feature, layer) {
  layer.bindPopup(feature.properties.name);
  layer.on('mouseover', function (e) {
            this.openPopup();
            });
  layer.on('mouseout', function (e) {
            this.closePopup();
            });
  layer.on('click', function (e) {
      placeName = feature.properties.name
      localStorage.setItem(placeName, this.getLatLng().toString());
      this.setStyle({fillColor: '#89959C', stroke: '#000000'});
      });
    }

  geojsonLayer = L.geoJson(geojson, {
      style: function(feature) {
        return {color: feature.properties.visit};
      },
      pointToLayer: function(feature, latlng) {
        var currentZoom = map.getZoom();
        return new L.CircleMarker(latlng, {radius: 10, fillOpacity: 0.85});
      },
      onEachFeature: onEachFeature
  });
map.addLayer(geojsonLayer);

</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</body>
</html>
